# Dark Halo Scope: Phase 1 / 1.5 / 1.6 Status Report

*(All numbers below are taken directly from the CSVs and scripts provided, not inferred.)*

## 0. Scientific Context

### Goal of Phase 1.x
My goal in **Phase 1.x** is to use **DESI Legacy Survey DR10** imaging to identify a statistically well-motivated “primary” sky region where strong lensing is most likely, based on large-scale structure and image quality, *before* doing any detailed pixel-level modeling.

### What I have achieved so far
I have now:
1. **Defined an analytic framework** for the “seeing wall” (Phase 1).
2. **Built an EMR-based pipeline** that scans DR10 sweeps and counts LRG-like galaxies per brick (Phase 1.5).
3. **Merged those counts with DR10 brick quality metrics** and selected a primary and backup contiguous region in RA/Dec (Phase 1.6).

The rest of this report is a numerical summary of what is actually present in the data and configuration as of my latest run.

---

## 1. Phase 1: Analytic Configuration
*(Seeing wall and cosmology)*

From `Phase1Config` (no data involved yet, but sets physical scales):

**Pixel & Seeing**
* **Pixel scale:** $0.262$ arcsec/pixel (DECam coadds)
* **Typical Seeing FWHM:**
    * $g$: $1.35$ arcsec
    * $r$: $1.25$ arcsec
    * $z$: $1.30$ arcsec

**Approximate $5\sigma$ depths (AB mag)**
* $g$: $24.5$
* $r$: $23.8$
* $z$: $23.0$

**Cosmology (Planck 2018 flat $\Lambda$CDM)**
* $H_0 = 67.4$ km/s/Mpc
* $\Omega_m = 0.315$

**Source Redshift & Seeing Wall**
* **Source Range:** $1.5 \le z_s \le 2.5$ (Representative: $z = 2.0$)
* **Thresholds:**
    * *Blind:* $\theta_E < 0.5 \times \text{FWHM}$
    * *Good resolution:* $\theta_E \ge 1.0 \times \text{FWHM}$

*This defines the analytic mapping from Einstein radius to “resolvable vs buried under the seeing disk” as a function of lens and source redshift.*

---

## 2. Phase 1.5: EMR LRG Density Map (Global Setup)

### 2.1 Data and Footprint
* **DR10 Imaging:** South sweeps `dr10/south/sweep/10.1/` from NERSC
* **EMR Job:** `spark_phase1p5_lrg_density.py`
    * Reads `sweep_urls.txt`
    * Streams each FITS sweep in chunks of **100,000 rows**
    * Applies LRG cuts and aggregates counts per `BRICKNAME`
* **Output:** `phase1p5_lrgcounts_fullsky_zlt20p4_rzgt0p4_zw1gt1p6_noRADecFilter_chunk100k.csv`

### 2.2 LRG Selection Hyperparameters
**Magnitude conversion:**
$$mag = 22.5 - 2.5 \log_{10}(flux)$$
*(Applied to flux_r, flux_z, flux_w1)*

**Cuts Applied:**
| Parameter | Condition | Value |
| :--- | :--- | :--- |
| **Magnitude** | `z_mag_max` | $z < 20.4$ |
| **Color** | `r_minus_z_min` | $(r - z) > 0.4$ |
| **Color** | `z_minus_w1_min` | $(z - W1) > 1.6$ |

**Implicit Cuts:**
* **Flux Sanity:** $flux_r > 0, flux_z > 0, flux_{w1} > 0$
* **Morphology:** Drop objects with `TYPE == 'PSF'` (keeps extended galaxies)
* **Spatial Filtering:** None in Phase 1.5 (Full Sky).

---

## 3. Phase 1.6: Brick-level Quality Cuts & Region Selection

Phase 1.6 joins DR10 brick catalogs (`ls_dr10.bricks_s`) with the EMR LRG counts.

**Script Run:**
```bash
python3 -m scripts.run_phase1p6_region_selection \
  --lrg-density-csv results/phase1p5_lrgcounts_...chunk100k.csv \
  --output-dir outputs/phase1p6
